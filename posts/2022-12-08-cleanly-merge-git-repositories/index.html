<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cleanly merge git repositories | Mero's Blog</title><meta name=keywords content="programming,git,advent-of-code"><meta name=description content="I describe how I did a clean, four-way merge of git repositories."><meta name=author content><link rel=canonical href=https://blog.merovius.de/posts/2022-12-08-cleanly-merge-git-repositories/><link crossorigin=anonymous href=/assets/css/stylesheet.min.f05a1c2e6a80eb4940c12054260e86cca78c7d0fe0e47ea390db536920db05a7.css integrity="sha256-8FocLmqA60lAwSBUJg6GzKeMfQ/g5H6jkNtTaSDbBac=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.merovius.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.merovius.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.merovius.de/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.merovius.de/apple-touch-icon.png><link rel=mask-icon href=https://blog.merovius.de/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel="preload stylesheet" href=https://blog.merovius.de/css/syntax.min.feec697016b5166ca8c6e23d68f6e97fcacd1fbd04d381a0639b2744f1a938c425d47396956cb5a7c9fcaf13d419675574dd51278b1ffcc0dc88e503b65c2785.css integrity="sha512-/uxpcBa1FmyoxuI9aPbpf8rNH70E04GgY5snRPGpOMQl1HOWlWy1p8n8rxPUGWdVdN1RJ4sf/MDciOUDtlwnhQ=="><meta property="og:title" content="Cleanly merge git repositories"><meta property="og:description" content="I describe how I did a clean, four-way merge of git repositories."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.merovius.de/posts/2022-12-08-cleanly-merge-git-repositories/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-08T12:05:00+00:00"><meta property="article:modified_time" content="2022-12-08T12:05:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Cleanly merge git repositories"><meta name=twitter:description content="I describe how I did a clean, four-way merge of git repositories."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.merovius.de/posts/"},{"@type":"ListItem","position":2,"name":"Cleanly merge git repositories","item":"https://blog.merovius.de/posts/2022-12-08-cleanly-merge-git-repositories/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cleanly merge git repositories","name":"Cleanly merge git repositories","description":"I describe how I did a clean, four-way merge of git repositories.","keywords":["programming","git","advent-of-code"],"articleBody":"Note: If you don’t want to read the exposition and explanations and just want to know the steps I did, scroll to the summary at the bottom.\nFor a couple of years I have (with varying degrees of commitment) participated in Advent of Code, a yearly programming competition. It consists of fun little daily challenges. It is great to exercise your coding muscles and can provide opportunity to learn new languages and technologies.\nSo far I have created a separate repository for each year, with a directory per day. But I decided that I’d prefer to have a single repository, containing my solutions for all years. The main reason is that I tend to write little helpers that I would like to re-use between years.\nWhen merging the repositories it was important to me to preserve the history of the individual years as well, though. I googled around for how to do this and the solutions I found didn’t quite work for me. So I thought I should document my own solution, in case anyone finds it useful.\nYou can see the result here. As you can see, there are four cleanly disjoint branches with separate histories. They then merge into one single commit.\nOne neat effect of this is that the merged repository functions as a normal remote for all the four old repositories. It involves no rewrites of history and all the previous commits are preserved exactly as-is. So you can just git pull from this new repository and git will fast-forward the branch.\nStep 1: Prepare individual repositories First I went through all repositories and prepared them. I wanted to have the years in individual directories. In theory, it is possible to use git-filter-repo and similar tooling to automate this step. For larger projects this might be worth it.\nI found it simpler to manually make the changes in the individual repositories and commit them. In particular, I did not only need to move the files to the sub directory, I also had to fix up Go module and import paths. Figuring out how to automate that seemed like a chore. But doing it manually is a quick and easy sed command.\nYou can see an example of that in this commit. While that link points at the final, merged repository, I created the commit in the old repository. You can see that a lot of files simply moved. But some also had additional changes.\nYou can also see that I left the go.mod in the top-level directory. That was intentional - I want the final repository to share a single module, so that’s where the go.mod belongs.\nAfter this I was left with four repositories, each of which had all the solutions in their own subdirectory, with a go.mod/go.sum file with the shared module path. I tested that all solutions still compile and appeared to work and moved on.\nStep 2: Prepare merged repository The next step is to create a new repository which can reference commits and objects in all the other repos. After all, it needs to contain the individual histories. This is simple by setting the individual repositories as remotes:\n$ mkdir ~/src/github.com/Merovius/AdventOfCode $ cd ~/src/github.com/Merovius/AdventOfCode $ git init $ git remote add 2018 ~/src/github.com/Merovius/aoc18 $ git remote add 2020 ~/src/github.com/Merovius/aoc_2020 $ git remote add 2021 ~/src/github.com/Merovius/aoc_2021 $ git remote add 2022 ~/src/github.com/Merovius/aoc_2022 $ git fetch --multiple 2018 2020 2021 2022 $ git branch -a remotes/2018/master remotes/2020/main remotes/2021/main remotes/2022/main One thing worth pointing out is that at this point, the merged AdventOfCode repository does not have any branches itself. The only existing branches are remotes/ references. This is relevant because we don’t want our resulting histories to share any common ancestor. And because git behaves slightly differently in an empty repository. A lot of commands operate on HEAD (the “current branch”), so they have special handling if there is no HEAD.\nStep 3: Create merge commit A git commit can have an arbitrary number of “parents”:\n If a commit has zero parents, it is the start of the history. This is what happens if you run git commit in a fresh repository. If a commit has exactly one parent, it is a regular commit. This is what happens when you run git commit normally. If a parent has more than one parent, it is a merge commit. This is what happens when you use git merge or merge a pull request in the web UI of a git hoster (like GitHub or Gitlab).  Normally merge commits have two parents - one that is the “main” branch and one that is being “merged into”. However, git does not really distinguish between “main” and “merged” branch. And it also allows a branch to have more than two parents.\nWe want to create a new commit with four parents: The HEADs of our four individual repositories. I expected this to be simple, but:\n$ git merge --allow-unrelated-histories remotes/2018/master remotes/2020/main remotes/2021/main remotes/2022/main fatal: Can merge only exactly one commit into empty head This command was supposed to create a merge commit with four parents. We have to pass --allow-unrelated-histories, as git otherwise tries to find a common ancestor between the parents and complains if it can’t find any.\nBut the command is failing. It seems git is unhappy using git merge with multiple parents if we do not have any branch yet.\nI suspect the intended path at this point would be to check out one of the branches and then merge the others into that. But that creates merge conflicts and it also felt… asymmetric to me. I did not want to give any of the base repositories preference. So instead I opted for a more brute-force approach: Dropping down to the plumbing layer.\nFirst, I created the merged directory structure:\n$ cp -r ~/src/github.com/Merovius/aoc18/* . $ cp -r ~/src/github.com/Merovius/aoc_2020/* . $ cp -r ~/src/github.com/Merovius/aoc_2021/* . $ cp -r ~/src/github.com/Merovius/aoc_2022/* . $ vim go.mod # fix up the merged list of dependencies $ go mod tidy $ git add . Note: The above does not copy hidden files (like .gitignore). If you do copy hidden files, take care not to copy any .git directories.\nAt this point the working directory contains the complete directory layout for the merged commit and it is all in the staging area (or “index”). This is where we normally run git commit. Instead we do the equivalent steps manually, allowing us to override the exact contents:\n$ TREE=$(git write-tree) $ COMMIT=$(git commit-tree $TREE \\  -p remotes/2018/master \\  -p remotes/2020/main \\  -p remotes/2021/main \\  -p remotes/2022/main \\  -m \"merge history of all years\") $ git branch main $COMMIT The write-tree command takes the content of the index and writes it to a “Tree Object” and then returns a reference to the Tree it has written.\nA Tree is an immutable representation of a directory in git. It (essentially) contains a list of file name and ID pairs, where each ID points either to a “Blob” (an immutable file) or another Tree.\nA Commit in git is just a Tree (describing the state of the files in the repository at that commit), a list of parents, a commit message and some meta data (like who created the commit and when).\nThe commit-tree command is a low-level command to create such a Commit object. We give it the ID of the Tree the Commit should contain and a list of parents (using -p) as well as a message (using -m). It then writes out that Commit to storage and returns its ID.\nAt this point we have a well-formed Commit, but it is just loosely stored in the repository. We still need a Branch to point at it, so it doesn’t get lost and we have a memorable handle.\nYou probably used the git branch command before. In the form above, it creates a new branch main (remember: So far our repository had no branches) pointing at the Commit we created.\nAnd that’s it. We can now treat the repository as a normal git repo. All that is left is to publish it:\n$ git remote add origin git@github.com:Merovius/AdventOfCode $ git push --set-upstream origin main Executive Summary To summarize the steps I did:\n Create commits in each of the old repositories to move files around and fixing anticipated merge conflicts as needed. Create a pristine new repository without any branches: $ git init merged $ cd merged  Add the old repositories as remotes for the merged repo: $ git remote add  /path/to/repo1 $ git fetch repo1 $ git remote add  /path/to/repo2 $ git fetch repo2 $ # …  Copy files from old repositories into merged repo: $ cp -r /path/to/repo1/* . $ cp -r /path/to/repo2/* . $ # …  Create commit using plumbing commands: $ git add . $ TREE=$(git write-tree) $ COMMIT=$(git commit-tree $TREE \\  -m \"merge repositories\" \\  -p remotes/repo1/main \\  -p remotes/repo2/main) $ git branch main $COMMIT   ","wordCount":"1488","inLanguage":"en","datePublished":"2022-12-08T12:05:00Z","dateModified":"2022-12-08T12:05:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.merovius.de/posts/2022-12-08-cleanly-merge-git-repositories/"},"publisher":{"@type":"Organization","name":"Mero's Blog","logo":{"@type":"ImageObject","url":"https://blog.merovius.de/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.merovius.de/ accesskey=h title="Mero's Blog (Alt + H)">Mero's Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Cleanly merge git repositories</h1><div class=post-meta><span title="2022-12-08 12:05:00 +0000 UTC">December 8, 2022</span></div></header><div class=post-content><p><em>Note: If you don&rsquo;t want to read the exposition and explanations and just want
to know the steps I did, scroll to the summary at the bottom.</em></p><p>For a couple of years I have (with varying degrees of commitment) participated
in <a href=https://adventofcode.com/>Advent of Code</a>, a yearly programming
competition. It consists of fun little daily challenges. It is great to
exercise your coding muscles and can provide opportunity to learn new languages
and technologies.</p><p>So far I have created a separate repository for each year, with a directory
per day. But I decided that I&rsquo;d prefer to have a single repository, containing
my solutions for <em>all</em> years. The main reason is that I tend to write little
helpers that I would like to re-use between years.</p><p>When merging the repositories it was important to me to preserve the history
of the individual years as well, though. I googled around for how to do this
and the solutions I found didn&rsquo;t <em>quite</em> work for me. So I thought I should
document my own solution, in case anyone finds it useful.</p><p>You can <a href=https://github.com/Merovius/AdventOfCode/network>see the result here</a>.
As you can see, there are four cleanly disjoint branches with separate
histories. They then merge into one single commit.</p><p>One neat effect of this is that the merged repository functions as a normal
remote for all the four old repositories. It involves no rewrites of history
and all the previous commits are preserved exactly as-is. So you can just <code>git pull</code> from this new repository and git will fast-forward the branch.</p><h1 id=step-1-prepare-individual-repositories>Step 1: Prepare individual repositories<a hidden class=anchor aria-hidden=true href=#step-1-prepare-individual-repositories>#</a></h1><p>First I went through all repositories and prepared them. I wanted to have the
years in individual directories. In theory, it is possible to use
<a href=https://git-scm.com/docs/git-filter-branch>git-filter-repo</a> and similar
tooling to automate this step. For larger projects this might be worth it.</p><p>I found it simpler to manually make the changes in the individual repositories
and commit them. In particular, I did not only need to move the files to the
sub directory, I also had to fix up Go module and import paths. Figuring out
how to automate that seemed like a chore. But doing it manually is a quick and
easy <code>sed</code> command.</p><p>You can see an example of that
<a href=https://github.com/Merovius/AdventOfCode/commit/8acd4ccd75c3e77cebacad98561bcf23a00e986e>in this commit</a>.
While that link points at the final, merged repository, I created the commit in
the old repository. You can see that a lot of files simply moved. But some also
had additional changes.</p><p>You can also see that I left the <code>go.mod</code> in the top-level directory. That was
intentional - I want the final repository to share a single module, so that&rsquo;s
where the <code>go.mod</code> belongs.</p><p>After this I was left with four repositories, each of which had all the
solutions in their own subdirectory, with a <code>go.mod</code>/<code>go.sum</code> file with the
shared module path. I tested that all solutions still compile and appeared to
work and moved on.</p><h1 id=step-2-prepare-merged-repository>Step 2: Prepare merged repository<a hidden class=anchor aria-hidden=true href=#step-2-prepare-merged-repository>#</a></h1><p>The next step is to create a new repository which can reference commits and
objects in all the other repos. After all, it needs to contain the individual
histories. This is simple by setting the individual repositories as remotes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mkdir ~/src/github.com/Merovius/AdventOfCode
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> ~/src/github.com/Merovius/AdventOfCode
</span></span><span class=line><span class=cl>$ git init
</span></span><span class=line><span class=cl>$ git remote add <span class=m>2018</span> ~/src/github.com/Merovius/aoc18
</span></span><span class=line><span class=cl>$ git remote add <span class=m>2020</span> ~/src/github.com/Merovius/aoc_2020
</span></span><span class=line><span class=cl>$ git remote add <span class=m>2021</span> ~/src/github.com/Merovius/aoc_2021
</span></span><span class=line><span class=cl>$ git remote add <span class=m>2022</span> ~/src/github.com/Merovius/aoc_2022
</span></span><span class=line><span class=cl>$ git fetch --multiple <span class=m>2018</span> <span class=m>2020</span> <span class=m>2021</span> <span class=m>2022</span>
</span></span><span class=line><span class=cl>$ git branch -a
</span></span><span class=line><span class=cl>remotes/2018/master
</span></span><span class=line><span class=cl>remotes/2020/main
</span></span><span class=line><span class=cl>remotes/2021/main
</span></span><span class=line><span class=cl>remotes/2022/main
</span></span></code></pre></div><p>One thing worth pointing out is that at this point, the merged <code>AdventOfCode</code>
repository <em>does not have any branches itself</em>. The only existing branches are
<code>remotes/</code> references. This is relevant because we don&rsquo;t want our resulting
histories to share any common ancestor. And because git behaves slightly
differently in an empty repository. A lot of commands operate on <code>HEAD</code> (the
“current branch”), so they have special handling if there is no <code>HEAD</code>.</p><h1 id=step-3-create-merge-commit>Step 3: Create merge commit<a hidden class=anchor aria-hidden=true href=#step-3-create-merge-commit>#</a></h1><p>A git commit can have an arbitrary number of “parents”:</p><ul><li>If a commit has zero parents, it is the start of the history. This is what
happens if you run <code>git commit</code> in a fresh repository.</li><li>If a commit has exactly one parent, it is a regular commit. This is what
happens when you run <code>git commit</code> normally.</li><li>If a parent has more than one parent, it is a merge commit. This is what
happens when you use <code>git merge</code> or merge a pull request in the web UI of a
git hoster (like GitHub or Gitlab).</li></ul><p>Normally merge commits have two parents - one that is the “main” branch and
one that is being “merged into”. However, git does not really distinguish
between “main” and “merged” branch. And it also allows a branch to have <em>more</em>
than two parents.</p><p>We want to create a new commit with four parents: The <code>HEAD</code>s of our four
individual repositories. I expected this to be simple, but:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git merge --allow-unrelated-histories remotes/2018/master remotes/2020/main remotes/2021/main remotes/2022/main
</span></span><span class=line><span class=cl>fatal: Can merge only exactly one commit into empty head
</span></span></code></pre></div><p>This command was supposed to create a merge commit with four parents. We have
to pass <code>--allow-unrelated-histories</code>, as git otherwise tries to find a common
ancestor between the parents and complains if it can&rsquo;t find any.</p><p>But the command is failing. It seems git is unhappy using <code>git merge</code> with
multiple parents if we do not have any branch yet.</p><p>I suspect the intended path at this point would be to check out one of the
branches and then merge the others into that. But that creates merge conflicts
and it also felt… asymmetric to me. I did not want to give any of the base
repositories preference. So instead I opted for a more brute-force approach:
Dropping down to the
<a href=https://git-scm.com/book/en/v2/Git-Internals-Plumbing-and-Porcelain>plumbing layer</a>.</p><p>First, I created the merged directory structure:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cp -r ~/src/github.com/Merovius/aoc18/* .
</span></span><span class=line><span class=cl>$ cp -r ~/src/github.com/Merovius/aoc_2020/* .
</span></span><span class=line><span class=cl>$ cp -r ~/src/github.com/Merovius/aoc_2021/* .
</span></span><span class=line><span class=cl>$ cp -r ~/src/github.com/Merovius/aoc_2022/* .
</span></span><span class=line><span class=cl>$ vim go.mod <span class=c1># fix up the merged list of dependencies</span>
</span></span><span class=line><span class=cl>$ go mod tidy
</span></span><span class=line><span class=cl>$ git add .
</span></span></code></pre></div><p><em>Note: The above does not copy hidden files (like <code>.gitignore</code>). If you do
copy hidden files, take care not to copy any <code>.git</code> directories.</em></p><p>At this point the working directory contains the complete directory layout for
the merged commit and it is all in the staging area (or “index”). This is where
we normally run <code>git commit</code>. Instead we do the equivalent steps manually,
allowing us to override the exact contents:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nv>TREE</span><span class=o>=</span><span class=k>$(</span>git write-tree<span class=k>)</span>
</span></span><span class=line><span class=cl>$ <span class=nv>COMMIT</span><span class=o>=</span><span class=k>$(</span>git commit-tree <span class=nv>$TREE</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -p remotes/2018/master <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -p remotes/2020/main <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -p remotes/2021/main <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -p remotes/2022/main <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -m <span class=s2>&#34;merge history of all years&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>$ git branch main <span class=nv>$COMMIT</span>
</span></span></code></pre></div><p>The <code>write-tree</code> command takes the content of the index and writes it to a
<a href=https://git-scm.com/book/en/v2/Git-Internals-Git-Objects#_tree_objects>“Tree Object”</a>
and then returns a reference to the Tree it has written.</p><p>A Tree is an immutable representation of a directory in git. It (essentially)
contains a list of file name and ID pairs, where each ID points either to a
“Blob” (an immutable file) or another Tree.</p><p>A Commit in git is just a Tree (describing the state of the files in the
repository at that commit), a list of parents, a commit message and some meta
data (like who created the commit and when).</p><p>The <code>commit-tree</code> command is a low-level command to create such a Commit
object. We give it the ID of the Tree the Commit should contain and a list of
parents (using <code>-p</code>) as well as a message (using <code>-m</code>). It then writes out that
Commit to storage and returns its ID.</p><p>At this point we have a well-formed Commit, but it is just loosely stored in
the repository. We still need a Branch to point at it, so it doesn&rsquo;t get lost
and we have a memorable handle.</p><p>You probably used the <code>git branch</code> command before. In the form above, it
creates a new branch <code>main</code> (remember: So far our repository had no branches)
pointing at the Commit we created.</p><p>And that&rsquo;s it. We can now treat the repository as a normal git repo. All that
is left is to publish it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git remote add origin git@github.com:Merovius/AdventOfCode
</span></span><span class=line><span class=cl>$ git push --set-upstream origin main
</span></span></code></pre></div><h1 id=executive-summary>Executive Summary<a hidden class=anchor aria-hidden=true href=#executive-summary>#</a></h1><p>To summarize the steps I did:</p><ol><li>Create commits in each of the old repositories to move files around and
fixing anticipated merge conflicts as needed.</li><li>Create a pristine new repository without any branches:<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git init merged
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> merged
</span></span></code></pre></div></li><li>Add the old repositories as remotes for the merged repo:<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git remote add &lt;repo1&gt; /path/to/repo1
</span></span><span class=line><span class=cl>$ git fetch repo1
</span></span><span class=line><span class=cl>$ git remote add &lt;repo2&gt; /path/to/repo2
</span></span><span class=line><span class=cl>$ git fetch repo2
</span></span><span class=line><span class=cl>$ <span class=c1># …</span>
</span></span></code></pre></div></li><li>Copy files from old repositories into merged repo:<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cp -r /path/to/repo1/* .
</span></span><span class=line><span class=cl>$ cp -r /path/to/repo2/* .
</span></span><span class=line><span class=cl>$ <span class=c1># …</span>
</span></span></code></pre></div></li><li>Create commit using plumbing commands:<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git add .
</span></span><span class=line><span class=cl>$ <span class=nv>TREE</span><span class=o>=</span><span class=k>$(</span>git write-tree<span class=k>)</span>
</span></span><span class=line><span class=cl>$ <span class=nv>COMMIT</span><span class=o>=</span><span class=k>$(</span>git commit-tree <span class=nv>$TREE</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -m <span class=s2>&#34;merge repositories&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -p remotes/repo1/main <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    -p remotes/repo2/main<span class=k>)</span>
</span></span><span class=line><span class=cl>$ git branch main <span class=nv>$COMMIT</span>
</span></span></code></pre></div></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.merovius.de/tags/programming/>programming</a></li><li><a href=https://blog.merovius.de/tags/git/>git</a></li><li><a href=https://blog.merovius.de/tags/advent-of-code/>advent-of-code</a></li></ul></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer><div class=social-icons><a href=https://twitter.com/TheMerovius target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://chaos.social/@Merovius target=_blank rel="noopener noreferrer me" title=Mastodon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.58 13.913c-.29 1.469-2.592 3.121-5.238 3.396-1.379.184-2.737.368-4.185.276-2.368-.092-4.237-.551-4.237-.551.0.184.014.459.043.643.308 2.294 2.317 2.478 4.22 2.57 1.922.0 3.633-.46 3.633-.46l.079 1.653s-1.344.734-3.738.918c-1.32.091-2.96-.092-4.869-.551-4.14-1.102-4.853-5.507-4.961-10.005-.034-1.285-.013-2.57-.013-3.58.0-4.589 3-5.966 3-5.966 1.513-.734 4.11-1.01 6.808-1.01h.067c2.699.0 5.296.276 6.81 1.01.0.0 3 1.377 3 5.967.0.0.037 3.304-.419 5.69" stroke="currentcolor"/><path d="M17.832 8.633v5h-1.978V8.78c0-1.023-.43-1.542-1.29-1.542-.95.0-1.427.616-1.427 1.834v2.655H11.17V9.072c0-1.218-.476-1.834-1.427-1.834-.86.0-1.29.52-1.29 1.542v4.852H6.475V8.633c0-1.022.26-1.834.782-2.434.538-.6 1.243-.909 2.118-.909 1.012.0 1.779.39 2.286 1.169l.492.827.493-.827c.507-.78 1.274-1.169 2.286-1.169.875.0 1.58.308 2.118.909.522.6.782 1.412.782 2.434" fill="currentcolor" stroke="none"/></svg></a><a href=https://github.com/Merovius target=_blank rel="noopener noreferrer me" title=GitHub><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://www.reddit.com/user/TheMerovius target=_blank rel="noopener noreferrer me" title=Reddit><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1"><path d="M24 11.779c0-1.459-1.192-2.645-2.657-2.645-.715.0-1.363.286-1.84.746-1.81-1.191-4.259-1.949-6.971-2.046l1.483-4.669 4.016.941-.006.058c0 1.193.975 2.163 2.174 2.163 1.198.0 2.172-.97 2.172-2.163S21.396 2 20.199 2c-.92.0-1.704.574-2.021 1.379l-4.329-1.015c-.189-.046-.381.063-.44.249L11.755 7.82c-2.838.034-5.409.798-7.3 2.025-.474-.438-1.103-.712-1.799-.712-1.465.0-2.656 1.187-2.656 2.646.0.97.533 1.811 1.317 2.271-.052.282-.086.567-.086.857C1.231 18.818 6.039 22 11.95 22s10.72-3.182 10.72-7.093c0-.274-.029-.544-.075-.81.832-.447 1.405-1.312 1.405-2.318zM6.776 13.595c0-.868.71-1.575 1.582-1.575s1.581.707 1.581 1.575-.709 1.574-1.581 1.574-1.582-.706-1.582-1.574zm9.061 4.669c-.797.793-2.048 1.179-3.824 1.179L12 19.44l-.013.003c-1.777.0-3.028-.386-3.824-1.179-.145-.144-.145-.379.0-.523.145-.145.381-.145.526.0.65.647 1.729.961 3.298.961l.013.003.013-.003c1.569.0 2.648-.315 3.298-.962.145-.145.381-.144.526.0.145.145.145.379.0.524zm-.189-3.095c-.872.0-1.581-.706-1.581-1.574s.709-1.575 1.581-1.575 1.581.707 1.581 1.575-.709 1.574-1.581 1.574z"/></svg></a></div></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>